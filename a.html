<html>
    <head>
        <script>
function drawFace(ctx, radius) {
    var grad;

    // erase everything.
    // TODO: not sure if we need this
    // ctx.clearRect(0, 0, 400, 400)

    
    // outer/background circle
    ctx.beginPath();
    ctx.arc(0, 0, radius, 0, 2*Math.PI);
    ctx.fillStyle = 'white';
    ctx.fill();

    grad = ctx.createRadialGradient(0,0,radius*0.95, 0,0,radius*1.05);
    grad.addColorStop(0, '#333');
    grad.addColorStop(0.5, 'white');
    grad.addColorStop(1, '#333');
    ctx.strokeStyle = grad;
    ctx.lineWidth = radius*0.1;
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(0, 0, radius*0.1, 0, 2*Math.PI);
    ctx.fillStyle = '#333';
    ctx.fill();
}

function drawNumbers(ctx, radius) {
    var ang;
    var num;
    ctx.font = radius*0.15 + "px arial";
    ctx.textBaseline="middle";
    ctx.textAlign="center";
    for(num= 1; num < 13; num++){
        ang = num * Math.PI / 6;
        ctx.rotate(ang);
        ctx.translate(0, -radius*0.85);
        ctx.rotate(-ang);
        ctx.fillText(num.toString(), 0, 0);
        ctx.rotate(ang);
        ctx.translate(0, radius*0.85);
        ctx.rotate(-ang);
    }
}


function drawTime(ctx, radius){
    var now = new Date();
    var hour = now.getHours();
    var minute = now.getMinutes();
    var second = now.getSeconds();
    //hour
    hour=hour%12;
    hour=(hour*Math.PI/6)+(minute*Math.PI/(6*60))+(second*Math.PI/(360*60));
    drawHand(ctx, hour, radius*0.5, radius*0.07);
    //minute
    minute=(minute*Math.PI/30)+(second*Math.PI/(30*60));
    drawHand(ctx, minute, radius*0.8, radius*0.07);
    // second
    second=(second*Math.PI/30);
    drawHand(ctx, second, radius*0.9, radius*0.02);
}

function drawHand(ctx, pos, length, width) {
    ctx.beginPath();
    ctx.lineWidth = width;
    ctx.lineCap = "round";
    ctx.moveTo(0,0);
    ctx.rotate(pos);
    ctx.lineTo(0, -length);
    ctx.stroke();
    ctx.rotate(-pos);
}

/* Draw the clock by completely redrawing the canvas.
*/
function drawClock() {
    drawFace(ctx, radius);
    drawNumbers(ctx, radius);
    drawTime(ctx, radius);
}

/*
* an attempt at just drawing the hands;
* doesn't quite work as I expected.
* the hands don't disappear when ctx.restore() is called.
* I@m not conivinced that save() and restore() are working.
  I think save/restore will save/restore the settings, e.g.
  styles, transformations etc, rather than saving the canvas
  as it is at a certain point in time.

  [] Todo; investigate if getImageData/putImageData works instead;
     it might just be simpler to redraw the entire clock; it doesn't
     take long!
*/
function justRedrawHands() {
    // ctx.clearRect(0, 0, 400, 400)
    ctx.restore()
    drawTime(ctx, radius)
}



      </script>
    </head>


    <body>
        <p>
            An HTML Canvas clock, based on
            <a href="https://www.w3schools.com/graphics/canvas_clock_start.asp">https://www.w3schools.com/graphics/canvas_clock_start.asp</a>
        </p>

        <div class="container-1">
            <canvas id="canvas" width="400" height="400" style="background-color:#333"></canvas>
            <button onclick="drawTime(ctx, radius);">draw time</button>
        </div>


        <!-- ================================================================ -->

        <p>
            There are zillions of other Javascript clocks out there. Here are some I like the look of:
            <ul>
                <li><a href="https://codepen.io/ky0suke/pen/MyNXWX">https://codepen.io/ky0suke/pen/MyNXWX</a> - beautiful clock, includes click sound.</li>
                <li><a href="http://www.javascriptkit.com/script/script2/css3analogclock.shtml">http://www.javascriptkit.com/script/script2/css3analogclock.shtml</a>
                    CSS 3 analog clock, smooth second hand (JS to move the hands!)</li>
                <li><a href="http://www.encodedna.com/html5/canvas/simple-analog-clock-using-canvas-javascript.htm"
                    >http://www.encodedna.com/html5/canvas/simple-analog-clock-using-canvas-javascript.htm</a>
                    another tutorial with a nice-looking clock.</li>
                <li><a href="http://randomibis.com/coolclock/">http://randomibis.com/coolclock/</a> is a
                    customisable Canvas clock</li>
                <li><a href="https://github.com/sganz/analogclock">https://github.com/sganz/analogclock</a> a
                    clock with many nice features</li>
                <li><a href="http://www.aspdotnet-suresh.com/2013/04/8-best-jquery-clock-plugins-analog.html"
                    >http://www.aspdotnet-suresh.com/2013/04/8-best-jquery-clock-plugins-analog.html</a>
                    8 different JS clocks reviewed</li>
            </ul>
        </p>

        <p>
            I want to erase and redraw the hands, but not necessarily the face.
            Apparently, it's OK to redraw the canvas all the time (see
            <a href="https://stackoverflow.com/questions/7365436/erasing-previously-drawn-lines-on-an-html5-canvas"
            >this stack overflow</a>), unless doing so results in a massive performance it (see
            <a href="https://stackoverflow.com/questions/5805705/is-it-asking-too-much-of-canvas-to-redraw-everything-inside-of-the-game-loop"
            ><i>this</i> stack overflow</a>)
        </p>

        <p>
            <b>To do</b> see if clearing the hands using getImageData/putImageData
            (see <a href="https://stackoverflow.com/a/29829625">here</a>) is the right approach.
            See also <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Basic_animations"
            >mozilla.org</a> (maybe requestAnimationFrame is the answer?)

            window.requestAnimationFrame() is a bit like window.setInterval() or window.setTimeout(), except it repeatedly
            calls your function at the refresh rate (e.g. 60 times a second)
        </p>

        <p>
            <b>To do</b> get the window size to draw the clock full-screen.
            (currently hard-coded in the HTML)
        </p>

        <script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var radius = canvas.height / 2;
ctx.translate(radius, radius); // remap 0,0 to the centre of the canvas.
radius = radius * 0.90
drawClock();
ctx.save()
// setInterval(drawClock, 100);

setInterval(justRedrawHands, 100); //doesn't work as expected


        </script>
    </body>
</html>
